{"ast":null,"code":"import axios from 'axios';\n\n// CRITICAL FIX: 拽专转 -API URL 拽抓 config -public\n// 拽爪 -public  注专 minification,  -URL 砖专\nlet API_BASE_URL = 'https://todoapis-qdh6.onrender.com';\n\n// 拽专转 -config  专爪 (  build)\n(async () => {\n  try {\n    const response = await fetch('/config.json');\n    const config = await response.json();\n    if (config.API_URL) {\n      API_BASE_URL = config.API_URL;\n    }\n  } catch (error) {\n    // Using default URL\n  }\n})();\n\n// 驻拽爪 注专 爪专转 config 注 JWT\nconst getConfig = () => {\n  const token = localStorage.getItem('jwt');\n  const config = {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  };\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n};\n\n// 驻拽爪 注专 驻 砖转\nconst handleError = error => {\n  var _error$response;\n  console.error('API Error:', ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n  if (error.response && error.response.status === 401) {\n    localStorage.removeItem('jwt');\n    if (window.location.pathname !== '/') {\n      window.location.href = '/';\n    }\n  }\n  throw error;\n};\nexport default {\n  // =====================\n  // Auth\n  // =====================\n  register: async (username, password) => {\n    try {\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      const result = await axios.post(`${apiUrl}/register`, {\n        username,\n        passwordHash: password\n      }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n  login: async (username, password) => {\n    try {\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      const result = await axios.post(`${apiUrl}/login`, {\n        username,\n        password\n      }, getConfig());\n      if (typeof result.data === 'string' && result.data.trim() !== '') {\n        try {\n          const parsed = JSON.parse(result.data);\n          if (parsed.token) {\n            localStorage.setItem('jwt', parsed.token);\n            return parsed.token;\n          }\n        } catch (e) {\n          // Continue to normal flow\n        }\n      }\n      if (!result.data || !result.data.token) {\n        throw new Error('No token received from server');\n      }\n      const token = result.data.token;\n      localStorage.setItem('jwt', token);\n      return token;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n  logout: () => {\n    localStorage.removeItem('jwt');\n  },\n  // =====================\n  // Tasks\n  // =====================\n  getTasks: async () => {\n    try {\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      const result = await axios.get(`${apiUrl}/tasks`, getConfig());\n      if (Array.isArray(result.data)) {\n        return result.data;\n      }\n      return [];\n    } catch (error) {\n      if (error.response && error.response.status === 401) {\n        localStorage.removeItem('jwt');\n      }\n      throw error;\n    }\n  },\n  addTask: async name => {\n    try {\n      // 拽专转 -API URL -config\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      console.log(' ADD TASK - Task name:', name);\n      const result = await axios.post(`${apiUrl}/tasks`, {\n        name,\n        isComplete: false\n      }, getConfig());\n      console.log(' ADD TASK - Success!', result.data);\n      return result.data;\n    } catch (error) {\n      var _error$response2;\n      console.error(' ADD TASK - Error:', error);\n      console.error(' ADD TASK - Error response:', (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data);\n      handleError(error);\n    }\n  },\n  setCompleted: async (id, name, isComplete) => {\n    try {\n      // 拽专转 -API URL -config\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      const result = await axios.put(`${apiUrl}/tasks/${id}`, {\n        id,\n        name,\n        isComplete\n      }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n  deleteTask: async id => {\n    try {\n      // 拽专转 -API URL -config\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      await axios.delete(`${apiUrl}/tasks/${id}`, getConfig());\n    } catch (error) {\n      handleError(error);\n    }\n  }\n};","map":{"version":3,"names":["axios","API_BASE_URL","response","fetch","config","json","API_URL","error","getConfig","token","localStorage","getItem","headers","Authorization","handleError","_error$response","console","data","message","status","removeItem","window","location","pathname","href","register","username","password","configResponse","apiUrl","result","post","passwordHash","login","trim","parsed","JSON","parse","setItem","e","Error","logout","getTasks","get","Array","isArray","addTask","name","log","isComplete","_error$response2","setCompleted","id","put","deleteTask","delete"],"sources":["C:/Users/user1/Desktop/转转-砖 /驻专拽拽/4/ToDoListReact-master/src/service.js"],"sourcesContent":["import axios from 'axios';\n\n// CRITICAL FIX: 拽专转 -API URL 拽抓 config -public\n// 拽爪 -public  注专 minification,  -URL 砖专\nlet API_BASE_URL = 'https://todoapis-qdh6.onrender.com';\n\n// 拽专转 -config  专爪 (  build)\n(async () => {\n  try {\n    const response = await fetch('/config.json');\n    const config = await response.json();\n    if (config.API_URL) {\n      API_BASE_URL = config.API_URL;\n    }\n  } catch (error) {\n    // Using default URL\n  }\n})();\n\n// 驻拽爪 注专 爪专转 config 注 JWT\nconst getConfig = () => {\n  const token = localStorage.getItem('jwt');\n  const config = {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  };\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n};\n\n// 驻拽爪 注专 驻 砖转\nconst handleError = (error) => {\n  console.error('API Error:', error.response?.data || error.message);\n  if (error.response && error.response.status === 401) {\n    localStorage.removeItem('jwt');\n    if (window.location.pathname !== '/') {\n      window.location.href = '/';\n    }\n  }\n  throw error;\n};\n\n\nexport default {\n  // =====================\n  // Auth\n  // =====================\n  register: async (username, password) => {\n    try {\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      \n      const result = await axios.post(`${apiUrl}/register`, { username, passwordHash: password }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n\n  login: async (username, password) => {\n    try {\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      \n      const result = await axios.post(`${apiUrl}/login`, { username, password }, getConfig());\n      \n      if (typeof result.data === 'string' && result.data.trim() !== '') {\n        try {\n          const parsed = JSON.parse(result.data);\n          if (parsed.token) {\n            localStorage.setItem('jwt', parsed.token);\n            return parsed.token;\n          }\n        } catch (e) {\n          // Continue to normal flow\n        }\n      }\n      \n      if (!result.data || !result.data.token) {\n        throw new Error('No token received from server');\n      }\n      \n      const token = result.data.token;\n      localStorage.setItem('jwt', token);\n      return token;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n\n  logout: () => {\n    localStorage.removeItem('jwt');\n  },\n\n  // =====================\n  // Tasks\n  // =====================\n  getTasks: async () => {\n    try {\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      \n      const result = await axios.get(`${apiUrl}/tasks`, getConfig());\n      \n      if (Array.isArray(result.data)) {\n        return result.data;\n      }\n      return [];\n    } catch (error) {\n      if (error.response && error.response.status === 401) {\n        localStorage.removeItem('jwt');\n      }\n      throw error;\n    }\n  },\n\n  \n  addTask: async (name) => {\n    try {\n      // 拽专转 -API URL -config\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      \n      console.log(' ADD TASK - Task name:', name);\n      \n      const result = await axios.post(`${apiUrl}/tasks`, { name, isComplete: false }, getConfig());\n      \n      console.log(' ADD TASK - Success!', result.data);\n      \n      return result.data;\n    } catch (error) {\n      console.error(' ADD TASK - Error:', error);\n      console.error(' ADD TASK - Error response:', error.response?.data);\n      handleError(error);\n    }\n  },\n\n  setCompleted: async (id, name, isComplete) => {\n    try {\n      // 拽专转 -API URL -config\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      \n      const result = await axios.put(`${apiUrl}/tasks/${id}`, { id, name, isComplete }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n\n  deleteTask: async (id) => {\n    try {\n      // 拽专转 -API URL -config\n      const configResponse = await fetch('/config.json');\n      const config = await configResponse.json();\n      const apiUrl = config.API_URL || 'https://todoapis-qdh6.onrender.com';\n      \n      await axios.delete(`${apiUrl}/tasks/${id}`, getConfig());\n    } catch (error) {\n      handleError(error);\n    }\n  }\n};\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;;AAEzB;AACA;AACA,IAAIC,YAAY,GAAG,oCAAoC;;AAEvD;AACA,CAAC,YAAY;EACX,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,cAAc,CAAC;IAC5C,MAAMC,MAAM,GAAG,MAAMF,QAAQ,CAACG,IAAI,CAAC,CAAC;IACpC,IAAID,MAAM,CAACE,OAAO,EAAE;MAClBL,YAAY,GAAGG,MAAM,CAACE,OAAO;IAC/B;EACF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACd;EAAA;AAEJ,CAAC,EAAE,CAAC;;AAEJ;AACA,MAAMC,SAAS,GAAGA,CAAA,KAAM;EACtB,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,KAAK,CAAC;EACzC,MAAMP,MAAM,GAAG;IACbQ,OAAO,EAAE;MACP,cAAc,EAAE;IAClB;EACF,CAAC;EACD,IAAIH,KAAK,EAAE;IACTL,MAAM,CAACQ,OAAO,CAACC,aAAa,GAAG,UAAUJ,KAAK,EAAE;EAClD;EACA,OAAOL,MAAM;AACf,CAAC;;AAED;AACA,MAAMU,WAAW,GAAIP,KAAK,IAAK;EAAA,IAAAQ,eAAA;EAC7BC,OAAO,CAACT,KAAK,CAAC,YAAY,EAAE,EAAAQ,eAAA,GAAAR,KAAK,CAACL,QAAQ,cAAAa,eAAA,uBAAdA,eAAA,CAAgBE,IAAI,KAAIV,KAAK,CAACW,OAAO,CAAC;EAClE,IAAIX,KAAK,CAACL,QAAQ,IAAIK,KAAK,CAACL,QAAQ,CAACiB,MAAM,KAAK,GAAG,EAAE;IACnDT,YAAY,CAACU,UAAU,CAAC,KAAK,CAAC;IAC9B,IAAIC,MAAM,CAACC,QAAQ,CAACC,QAAQ,KAAK,GAAG,EAAE;MACpCF,MAAM,CAACC,QAAQ,CAACE,IAAI,GAAG,GAAG;IAC5B;EACF;EACA,MAAMjB,KAAK;AACb,CAAC;AAGD,eAAe;EACb;EACA;EACA;EACAkB,QAAQ,EAAE,MAAAA,CAAOC,QAAQ,EAAEC,QAAQ,KAAK;IACtC,IAAI;MACF,MAAMC,cAAc,GAAG,MAAMzB,KAAK,CAAC,cAAc,CAAC;MAClD,MAAMC,MAAM,GAAG,MAAMwB,cAAc,CAACvB,IAAI,CAAC,CAAC;MAC1C,MAAMwB,MAAM,GAAGzB,MAAM,CAACE,OAAO,IAAI,oCAAoC;MAErE,MAAMwB,MAAM,GAAG,MAAM9B,KAAK,CAAC+B,IAAI,CAAC,GAAGF,MAAM,WAAW,EAAE;QAAEH,QAAQ;QAAEM,YAAY,EAAEL;MAAS,CAAC,EAAEnB,SAAS,CAAC,CAAC,CAAC;MACxG,OAAOsB,MAAM,CAACb,IAAI;IACpB,CAAC,CAAC,OAAOV,KAAK,EAAE;MACdO,WAAW,CAACP,KAAK,CAAC;IACpB;EACF,CAAC;EAED0B,KAAK,EAAE,MAAAA,CAAOP,QAAQ,EAAEC,QAAQ,KAAK;IACnC,IAAI;MACF,MAAMC,cAAc,GAAG,MAAMzB,KAAK,CAAC,cAAc,CAAC;MAClD,MAAMC,MAAM,GAAG,MAAMwB,cAAc,CAACvB,IAAI,CAAC,CAAC;MAC1C,MAAMwB,MAAM,GAAGzB,MAAM,CAACE,OAAO,IAAI,oCAAoC;MAErE,MAAMwB,MAAM,GAAG,MAAM9B,KAAK,CAAC+B,IAAI,CAAC,GAAGF,MAAM,QAAQ,EAAE;QAAEH,QAAQ;QAAEC;MAAS,CAAC,EAAEnB,SAAS,CAAC,CAAC,CAAC;MAEvF,IAAI,OAAOsB,MAAM,CAACb,IAAI,KAAK,QAAQ,IAAIa,MAAM,CAACb,IAAI,CAACiB,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;QAChE,IAAI;UACF,MAAMC,MAAM,GAAGC,IAAI,CAACC,KAAK,CAACP,MAAM,CAACb,IAAI,CAAC;UACtC,IAAIkB,MAAM,CAAC1B,KAAK,EAAE;YAChBC,YAAY,CAAC4B,OAAO,CAAC,KAAK,EAAEH,MAAM,CAAC1B,KAAK,CAAC;YACzC,OAAO0B,MAAM,CAAC1B,KAAK;UACrB;QACF,CAAC,CAAC,OAAO8B,CAAC,EAAE;UACV;QAAA;MAEJ;MAEA,IAAI,CAACT,MAAM,CAACb,IAAI,IAAI,CAACa,MAAM,CAACb,IAAI,CAACR,KAAK,EAAE;QACtC,MAAM,IAAI+B,KAAK,CAAC,+BAA+B,CAAC;MAClD;MAEA,MAAM/B,KAAK,GAAGqB,MAAM,CAACb,IAAI,CAACR,KAAK;MAC/BC,YAAY,CAAC4B,OAAO,CAAC,KAAK,EAAE7B,KAAK,CAAC;MAClC,OAAOA,KAAK;IACd,CAAC,CAAC,OAAOF,KAAK,EAAE;MACdO,WAAW,CAACP,KAAK,CAAC;IACpB;EACF,CAAC;EAEDkC,MAAM,EAAEA,CAAA,KAAM;IACZ/B,YAAY,CAACU,UAAU,CAAC,KAAK,CAAC;EAChC,CAAC;EAED;EACA;EACA;EACAsB,QAAQ,EAAE,MAAAA,CAAA,KAAY;IACpB,IAAI;MACF,MAAMd,cAAc,GAAG,MAAMzB,KAAK,CAAC,cAAc,CAAC;MAClD,MAAMC,MAAM,GAAG,MAAMwB,cAAc,CAACvB,IAAI,CAAC,CAAC;MAC1C,MAAMwB,MAAM,GAAGzB,MAAM,CAACE,OAAO,IAAI,oCAAoC;MAErE,MAAMwB,MAAM,GAAG,MAAM9B,KAAK,CAAC2C,GAAG,CAAC,GAAGd,MAAM,QAAQ,EAAErB,SAAS,CAAC,CAAC,CAAC;MAE9D,IAAIoC,KAAK,CAACC,OAAO,CAACf,MAAM,CAACb,IAAI,CAAC,EAAE;QAC9B,OAAOa,MAAM,CAACb,IAAI;MACpB;MACA,OAAO,EAAE;IACX,CAAC,CAAC,OAAOV,KAAK,EAAE;MACd,IAAIA,KAAK,CAACL,QAAQ,IAAIK,KAAK,CAACL,QAAQ,CAACiB,MAAM,KAAK,GAAG,EAAE;QACnDT,YAAY,CAACU,UAAU,CAAC,KAAK,CAAC;MAChC;MACA,MAAMb,KAAK;IACb;EACF,CAAC;EAGDuC,OAAO,EAAE,MAAOC,IAAI,IAAK;IACvB,IAAI;MACF;MACA,MAAMnB,cAAc,GAAG,MAAMzB,KAAK,CAAC,cAAc,CAAC;MAClD,MAAMC,MAAM,GAAG,MAAMwB,cAAc,CAACvB,IAAI,CAAC,CAAC;MAC1C,MAAMwB,MAAM,GAAGzB,MAAM,CAACE,OAAO,IAAI,oCAAoC;MAErEU,OAAO,CAACgC,GAAG,CAAC,0BAA0B,EAAED,IAAI,CAAC;MAE7C,MAAMjB,MAAM,GAAG,MAAM9B,KAAK,CAAC+B,IAAI,CAAC,GAAGF,MAAM,QAAQ,EAAE;QAAEkB,IAAI;QAAEE,UAAU,EAAE;MAAM,CAAC,EAAEzC,SAAS,CAAC,CAAC,CAAC;MAE5FQ,OAAO,CAACgC,GAAG,CAAC,wBAAwB,EAAElB,MAAM,CAACb,IAAI,CAAC;MAElD,OAAOa,MAAM,CAACb,IAAI;IACpB,CAAC,CAAC,OAAOV,KAAK,EAAE;MAAA,IAAA2C,gBAAA;MACdlC,OAAO,CAACT,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;MAC5CS,OAAO,CAACT,KAAK,CAAC,+BAA+B,GAAA2C,gBAAA,GAAE3C,KAAK,CAACL,QAAQ,cAAAgD,gBAAA,uBAAdA,gBAAA,CAAgBjC,IAAI,CAAC;MACpEH,WAAW,CAACP,KAAK,CAAC;IACpB;EACF,CAAC;EAED4C,YAAY,EAAE,MAAAA,CAAOC,EAAE,EAAEL,IAAI,EAAEE,UAAU,KAAK;IAC5C,IAAI;MACF;MACA,MAAMrB,cAAc,GAAG,MAAMzB,KAAK,CAAC,cAAc,CAAC;MAClD,MAAMC,MAAM,GAAG,MAAMwB,cAAc,CAACvB,IAAI,CAAC,CAAC;MAC1C,MAAMwB,MAAM,GAAGzB,MAAM,CAACE,OAAO,IAAI,oCAAoC;MAErE,MAAMwB,MAAM,GAAG,MAAM9B,KAAK,CAACqD,GAAG,CAAC,GAAGxB,MAAM,UAAUuB,EAAE,EAAE,EAAE;QAAEA,EAAE;QAAEL,IAAI;QAAEE;MAAW,CAAC,EAAEzC,SAAS,CAAC,CAAC,CAAC;MAC9F,OAAOsB,MAAM,CAACb,IAAI;IACpB,CAAC,CAAC,OAAOV,KAAK,EAAE;MACdO,WAAW,CAACP,KAAK,CAAC;IACpB;EACF,CAAC;EAED+C,UAAU,EAAE,MAAOF,EAAE,IAAK;IACxB,IAAI;MACF;MACA,MAAMxB,cAAc,GAAG,MAAMzB,KAAK,CAAC,cAAc,CAAC;MAClD,MAAMC,MAAM,GAAG,MAAMwB,cAAc,CAACvB,IAAI,CAAC,CAAC;MAC1C,MAAMwB,MAAM,GAAGzB,MAAM,CAACE,OAAO,IAAI,oCAAoC;MAErE,MAAMN,KAAK,CAACuD,MAAM,CAAC,GAAG1B,MAAM,UAAUuB,EAAE,EAAE,EAAE5C,SAAS,CAAC,CAAC,CAAC;IAC1D,CAAC,CAAC,OAAOD,KAAK,EAAE;MACdO,WAAW,CAACP,KAAK,CAAC;IACpB;EACF;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}