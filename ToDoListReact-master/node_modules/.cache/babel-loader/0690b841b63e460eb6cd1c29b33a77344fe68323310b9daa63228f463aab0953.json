{"ast":null,"code":"import axios from 'axios';\n\n// URL של ה-API - משתמש במשתנה סביבה לפי המטלה\n// ב-create-react-app משתני סביבה חייבים להתחיל ב-REACT_APP_\nconst API_URL = process.env.REACT_APP_API_URL || 'https://todoapis-qdh6.onrender.com';\n\n// פונקציה עזר ליצירת config עם JWT\nconst getConfig = () => {\n  const token = localStorage.getItem('jwt');\n  const config = {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  };\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n};\n\n// פונקציה עזר לטיפול בשגיאות\nconst handleError = error => {\n  var _error$response;\n  console.error('API Error:', ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n  if (error.response && error.response.status === 401) {\n    localStorage.removeItem('jwt');\n    if (window.location.pathname !== '/') {\n      window.location.href = '/';\n    }\n  }\n  throw error;\n};\nexport default {\n  // =====================\n  // Auth\n  // =====================\n  register: async (username, password) => {\n    try {\n      const result = await axios.post(`${API_URL}/register`, {\n        username,\n        passwordHash: password\n      }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n  login: async (username, password) => {\n    try {\n      const result = await axios.post(`${API_URL}/login`, {\n        username,\n        password\n      }, getConfig());\n      const token = result.data.token;\n      localStorage.setItem('jwt', token);\n      return token;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n  logout: () => {\n    localStorage.removeItem('jwt');\n  },\n  // =====================\n  // Tasks\n  // =====================\n  getTasks: async () => {\n    try {\n      const result = await axios.get(`${API_URL}/tasks`, getConfig());\n      // וודא שהתוצאה היא מערך\n      if (Array.isArray(result.data)) {\n        return result.data;\n      }\n      // אם זה לא מערך, נחזיר מערך ריק\n      return [];\n    } catch (error) {\n      var _error$response2;\n      console.error('Get tasks error:', ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data) || error.message);\n      // אם יש שגיאת 401, נטפל בה וזורקים שגיאה כדי שהקוד יידע\n      if (error.response && error.response.status === 401) {\n        localStorage.removeItem('jwt');\n        // זורקים שגיאה כדי שהקוד יידע שיש בעיה\n        throw error;\n      }\n      // אם זו שגיאה אחרת, גם זורקים\n      throw error;\n    }\n  },\n  addTask: async name => {\n    try {\n      const result = await axios.post(`${API_URL}/tasks`, {\n        name,\n        isComplete: false\n      }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n  setCompleted: async (id, name, isComplete) => {\n    try {\n      const result = await axios.put(`${API_URL}/tasks/${id}`, {\n        id,\n        name,\n        isComplete\n      }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n  deleteTask: async id => {\n    try {\n      await axios.delete(`${API_URL}/tasks/${id}`, getConfig());\n    } catch (error) {\n      handleError(error);\n    }\n  }\n};","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","getConfig","token","localStorage","getItem","config","headers","Authorization","handleError","error","_error$response","console","response","data","message","status","removeItem","window","location","pathname","href","register","username","password","result","post","passwordHash","login","setItem","logout","getTasks","get","Array","isArray","_error$response2","addTask","name","isComplete","setCompleted","id","put","deleteTask","delete"],"sources":["C:/Users/user1/Desktop/תכנות-שנה ב/פרקטיקוד/4/ToDoListReact-master/src/service.js"],"sourcesContent":["import axios from 'axios';\n\n// URL של ה-API - משתמש במשתנה סביבה לפי המטלה\n// ב-create-react-app משתני סביבה חייבים להתחיל ב-REACT_APP_\nconst API_URL = process.env.REACT_APP_API_URL || 'https://todoapis-qdh6.onrender.com';\n\n// פונקציה עזר ליצירת config עם JWT\nconst getConfig = () => {\n  const token = localStorage.getItem('jwt');\n  const config = {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  };\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n};\n\n// פונקציה עזר לטיפול בשגיאות\nconst handleError = (error) => {\n  console.error('API Error:', error.response?.data || error.message);\n  if (error.response && error.response.status === 401) {\n    localStorage.removeItem('jwt');\n    if (window.location.pathname !== '/') {\n      window.location.href = '/';\n    }\n  }\n  throw error;\n};\n\n\nexport default {\n  // =====================\n  // Auth\n  // =====================\n  register: async (username, password) => {\n    try {\n      const result = await axios.post(`${API_URL}/register`, { username, passwordHash: password }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n\n  login: async (username, password) => {\n    try {\n      const result = await axios.post(`${API_URL}/login`, { username, password }, getConfig());\n      const token = result.data.token;\n      localStorage.setItem('jwt', token);\n      return token;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n\n  logout: () => {\n    localStorage.removeItem('jwt');\n  },\n\n  // =====================\n  // Tasks\n  // =====================\n  getTasks: async () => {\n    try {\n      const result = await axios.get(`${API_URL}/tasks`, getConfig());\n      // וודא שהתוצאה היא מערך\n      if (Array.isArray(result.data)) {\n        return result.data;\n      }\n      // אם זה לא מערך, נחזיר מערך ריק\n      return [];\n    } catch (error) {\n      console.error('Get tasks error:', error.response?.data || error.message);\n      // אם יש שגיאת 401, נטפל בה וזורקים שגיאה כדי שהקוד יידע\n      if (error.response && error.response.status === 401) {\n        localStorage.removeItem('jwt');\n        // זורקים שגיאה כדי שהקוד יידע שיש בעיה\n        throw error;\n      }\n      // אם זו שגיאה אחרת, גם זורקים\n      throw error;\n    }\n  },\n\n  \n  addTask: async (name) => {\n    try {\n      const result = await axios.post(`${API_URL}/tasks`, { name, isComplete: false }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n\n  setCompleted: async (id, name, isComplete) => {\n    try {\n      const result = await axios.put(`${API_URL}/tasks/${id}`, { id, name, isComplete }, getConfig());\n      return result.data;\n    } catch (error) {\n      handleError(error);\n    }\n  },\n\n  deleteTask: async (id) => {\n    try {\n      await axios.delete(`${API_URL}/tasks/${id}`, getConfig());\n    } catch (error) {\n      handleError(error);\n    }\n  }\n};\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;;AAEzB;AACA;AACA,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,oCAAoC;;AAErF;AACA,MAAMC,SAAS,GAAGA,CAAA,KAAM;EACtB,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,KAAK,CAAC;EACzC,MAAMC,MAAM,GAAG;IACbC,OAAO,EAAE;MACP,cAAc,EAAE;IAClB;EACF,CAAC;EACD,IAAIJ,KAAK,EAAE;IACTG,MAAM,CAACC,OAAO,CAACC,aAAa,GAAG,UAAUL,KAAK,EAAE;EAClD;EACA,OAAOG,MAAM;AACf,CAAC;;AAED;AACA,MAAMG,WAAW,GAAIC,KAAK,IAAK;EAAA,IAAAC,eAAA;EAC7BC,OAAO,CAACF,KAAK,CAAC,YAAY,EAAE,EAAAC,eAAA,GAAAD,KAAK,CAACG,QAAQ,cAAAF,eAAA,uBAAdA,eAAA,CAAgBG,IAAI,KAAIJ,KAAK,CAACK,OAAO,CAAC;EAClE,IAAIL,KAAK,CAACG,QAAQ,IAAIH,KAAK,CAACG,QAAQ,CAACG,MAAM,KAAK,GAAG,EAAE;IACnDZ,YAAY,CAACa,UAAU,CAAC,KAAK,CAAC;IAC9B,IAAIC,MAAM,CAACC,QAAQ,CAACC,QAAQ,KAAK,GAAG,EAAE;MACpCF,MAAM,CAACC,QAAQ,CAACE,IAAI,GAAG,GAAG;IAC5B;EACF;EACA,MAAMX,KAAK;AACb,CAAC;AAGD,eAAe;EACb;EACA;EACA;EACAY,QAAQ,EAAE,MAAAA,CAAOC,QAAQ,EAAEC,QAAQ,KAAK;IACtC,IAAI;MACF,MAAMC,MAAM,GAAG,MAAM5B,KAAK,CAAC6B,IAAI,CAAC,GAAG5B,OAAO,WAAW,EAAE;QAAEyB,QAAQ;QAAEI,YAAY,EAAEH;MAAS,CAAC,EAAEtB,SAAS,CAAC,CAAC,CAAC;MACzG,OAAOuB,MAAM,CAACX,IAAI;IACpB,CAAC,CAAC,OAAOJ,KAAK,EAAE;MACdD,WAAW,CAACC,KAAK,CAAC;IACpB;EACF,CAAC;EAEDkB,KAAK,EAAE,MAAAA,CAAOL,QAAQ,EAAEC,QAAQ,KAAK;IACnC,IAAI;MACF,MAAMC,MAAM,GAAG,MAAM5B,KAAK,CAAC6B,IAAI,CAAC,GAAG5B,OAAO,QAAQ,EAAE;QAAEyB,QAAQ;QAAEC;MAAS,CAAC,EAAEtB,SAAS,CAAC,CAAC,CAAC;MACxF,MAAMC,KAAK,GAAGsB,MAAM,CAACX,IAAI,CAACX,KAAK;MAC/BC,YAAY,CAACyB,OAAO,CAAC,KAAK,EAAE1B,KAAK,CAAC;MAClC,OAAOA,KAAK;IACd,CAAC,CAAC,OAAOO,KAAK,EAAE;MACdD,WAAW,CAACC,KAAK,CAAC;IACpB;EACF,CAAC;EAEDoB,MAAM,EAAEA,CAAA,KAAM;IACZ1B,YAAY,CAACa,UAAU,CAAC,KAAK,CAAC;EAChC,CAAC;EAED;EACA;EACA;EACAc,QAAQ,EAAE,MAAAA,CAAA,KAAY;IACpB,IAAI;MACF,MAAMN,MAAM,GAAG,MAAM5B,KAAK,CAACmC,GAAG,CAAC,GAAGlC,OAAO,QAAQ,EAAEI,SAAS,CAAC,CAAC,CAAC;MAC/D;MACA,IAAI+B,KAAK,CAACC,OAAO,CAACT,MAAM,CAACX,IAAI,CAAC,EAAE;QAC9B,OAAOW,MAAM,CAACX,IAAI;MACpB;MACA;MACA,OAAO,EAAE;IACX,CAAC,CAAC,OAAOJ,KAAK,EAAE;MAAA,IAAAyB,gBAAA;MACdvB,OAAO,CAACF,KAAK,CAAC,kBAAkB,EAAE,EAAAyB,gBAAA,GAAAzB,KAAK,CAACG,QAAQ,cAAAsB,gBAAA,uBAAdA,gBAAA,CAAgBrB,IAAI,KAAIJ,KAAK,CAACK,OAAO,CAAC;MACxE;MACA,IAAIL,KAAK,CAACG,QAAQ,IAAIH,KAAK,CAACG,QAAQ,CAACG,MAAM,KAAK,GAAG,EAAE;QACnDZ,YAAY,CAACa,UAAU,CAAC,KAAK,CAAC;QAC9B;QACA,MAAMP,KAAK;MACb;MACA;MACA,MAAMA,KAAK;IACb;EACF,CAAC;EAGD0B,OAAO,EAAE,MAAOC,IAAI,IAAK;IACvB,IAAI;MACF,MAAMZ,MAAM,GAAG,MAAM5B,KAAK,CAAC6B,IAAI,CAAC,GAAG5B,OAAO,QAAQ,EAAE;QAAEuC,IAAI;QAAEC,UAAU,EAAE;MAAM,CAAC,EAAEpC,SAAS,CAAC,CAAC,CAAC;MAC7F,OAAOuB,MAAM,CAACX,IAAI;IACpB,CAAC,CAAC,OAAOJ,KAAK,EAAE;MACdD,WAAW,CAACC,KAAK,CAAC;IACpB;EACF,CAAC;EAED6B,YAAY,EAAE,MAAAA,CAAOC,EAAE,EAAEH,IAAI,EAAEC,UAAU,KAAK;IAC5C,IAAI;MACF,MAAMb,MAAM,GAAG,MAAM5B,KAAK,CAAC4C,GAAG,CAAC,GAAG3C,OAAO,UAAU0C,EAAE,EAAE,EAAE;QAAEA,EAAE;QAAEH,IAAI;QAAEC;MAAW,CAAC,EAAEpC,SAAS,CAAC,CAAC,CAAC;MAC/F,OAAOuB,MAAM,CAACX,IAAI;IACpB,CAAC,CAAC,OAAOJ,KAAK,EAAE;MACdD,WAAW,CAACC,KAAK,CAAC;IACpB;EACF,CAAC;EAEDgC,UAAU,EAAE,MAAOF,EAAE,IAAK;IACxB,IAAI;MACF,MAAM3C,KAAK,CAAC8C,MAAM,CAAC,GAAG7C,OAAO,UAAU0C,EAAE,EAAE,EAAEtC,SAAS,CAAC,CAAC,CAAC;IAC3D,CAAC,CAAC,OAAOQ,KAAK,EAAE;MACdD,WAAW,CAACC,KAAK,CAAC;IACpB;EACF;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}